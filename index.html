<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Controle de Gestão — Age Fibra</title>
  <style>
    :root{
      --bg:#fff7ed;
      --card:#ffffff;
      --brand:#ff7a00;
      --brand-dark:#e06b00;
      --muted:#6b4720;
      --success:#0b8a4e;
      --danger:#c53030;
      --radius:12px;
      --gap:12px;
    }

    *{box-sizing:border-box;font-family:Inter, "Segoe UI", Roboto, Arial, sans-serif}
    html,body{height:100%;}

    body{
      margin:0;
      background:linear-gradient(180deg,var(--bg),#ffffff);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      padding-top: calc(20px + env(safe-area-inset-top, 0px));
      padding-bottom: calc(20px + env(safe-area-inset-bottom, 0px));
      display:flex;justify-content:center;
    }

    .container{width:100%;max-width:980px;padding:18px}

    .card{
      background:var(--card);
      border-radius:var(--radius);
      padding:20px;
      box-shadow:0 10px 30px rgba(20,20,40,0.06);
      border-left:6px solid rgba(255,122,0,0.08);
      overflow:visible;
    }

    .header{
      display:flex;flex-direction:column;gap:8px;align-items:flex-start;margin-bottom:8px;
    }

    .header-top{width:100%;display:flex;align-items:center;gap:16px}
    #logo{height:56px;width:auto;flex-shrink:0}

    .titles{display:flex;flex-direction:column;gap:4px}
    .page-title{margin:0;font-size:18px;color:var(--brand);font-weight:800}
    .sub-title{margin:0;color:var(--muted);font-size:13px}

    .meta{margin-left:auto;color:var(--muted);font-size:13px}

    p.lead{margin:10px 0 16px;color:var(--muted)}

    form{display:grid;gap:14px}

    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    .grid-2{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}

    label{display:block;font-size:13px;color:#111827;margin-bottom:6px}
    input[type=text], input[type=tel], input[type=number], input[type=date], select, textarea{
      width:100%;padding:12px 14px;border:1px solid #e6e9ef;border-radius:10px;font-size:14px;background:white;color:#111827
    }
    textarea{min-height:110px;resize:vertical}

    .actions{display:flex;gap:10px;align-items:center;justify-content:flex-end;margin-top:4px}
    button{background:linear-gradient(180deg,var(--brand),var(--brand-dark));color:white;border:0;padding:12px 16px;border-radius:10px;cursor:pointer;font-weight:700}
    button.secondary{background:transparent;color:var(--brand);border:1px solid rgba(255,122,0,0.14)}

    .muted-sm{font-size:13px;color:var(--muted)}
    .result{padding:10px;border-radius:8px;margin-top:8px}
    .success{background:#ecfdf3;color:var(--success);border:1px solid rgba(11,138,78,0.08)}
    .error{background:#fff5f5;color:var(--danger);border:1px solid rgba(197,48,48,0.06)}
    .warning{background:#fffaeb;color:#7a4b00;border:1px solid rgba(255,122,0,0.06);color:#7a4b00}

    @media (max-width:1099px){
      .grid{grid-template-columns:repeat(2,1fr)}
      .grid-2{grid-template-columns:1fr}
    }

    @media (max-width:639px){
      .container{padding:12px}
      .card{padding:16px}
      .header-top{align-items:flex-start}
      .grid{grid-template-columns:1fr}
      .grid-2{grid-template-columns:1fr}
      .actions{flex-direction:column;align-items:stretch}
      button{width:100%}
      button.secondary{width:100%}
    }

    .site-footer{margin-top:16px;font-size:12px;color:var(--muted);text-align:center}
  </style>
</head>
<body>
  <div class="container">
    <main class="card" role="main">

      <header class="header">
        <div class="header-top">
          <img id="logo" src="Logo.png" alt="Age Fibra" />
          <div class="titles">
            <div class="page-title">Formulário Executivo — Controle de Gestão</div>
            <div class="sub-title">Registro de atendimento / visita para acompanhamento de campanhas e resultados</div>
          </div>
          <div class="meta">Usuário: <strong>Executivo</strong></div>
        </div>
      </header>

      <form id="managementForm" autocomplete="on" novalidate>

        <div class="grid">
          <div>
            <label for="campanha">Campanha</label>
            <input id="campanha" name="campanha" type="text" placeholder="Ex: Campanha Natal 2025" required>
          </div>

          <div>
            <label for="responsavel">Responsável</label>
            <input id="responsavel" name="responsavel" type="text" placeholder="Nome do executivo" required>
          </div>

          <div>
            <label for="regiao">Região ADM</label>
            <input id="regiao" name="regiao" type="text" placeholder="Ex: Norte / ADM 3" required>
          </div>
        </div>

        <div class="grid-2">
          <div>
            <label for="endereco">Endereço</label>
            <input id="endereco" name="endereco" type="text" placeholder="Rua, Avenida, Condomínio" required>
          </div>

          <div>
            <label for="numero">Número de apartamentos</label>
            <input id="numero" name="numero" type="text" placeholder="Ex: 50" required>
          </div>
        </div>

        <div class="grid-2">
          <div>
            <label for="sindico">Síndico</label>
            <input id="sindico" name="sindico" type="text" placeholder="Nome do síndico" required>
          </div>

          <div>
            <label for="telSindico">Telefone do síndico</label>
            <input id="telSindico" name="telSindico" type="tel" placeholder="(xx) 9xxxx-xxxx" required>
          </div>
        </div>

        <div class="grid">
          <div>
            <label for="idBitrix">ID Bitrix</label>
            <input id="idBitrix" name="idBitrix" type="text" placeholder="Ex: 12345">
          </div>

          <div>
            <label for="vendas">Vendas</label>
            <input id="vendas" name="vendas" type="number" min="0" step="1" placeholder="0">
          </div>

          <div>
            <label for="oportunidades">Oportunidades</label>
            <input id="oportunidades" name="oportunidades" type="number" min="0" step="1" placeholder="0">
          </div>
        </div>

        <div class="grid-2">
          <div>
            <label for="data">Data</label>
            <input id="data" name="data" type="date" required>
          </div>

          <div>
            <label for="status">Status</label>
            <input id="status" name="status" type="text" placeholder="Ex: Em andamento / Pendente" required>
          </div>
        </div>

        <div class="grid-2">
          <div>
            <label for="cartaAd">Carta de AD</label>
            <select id="cartaAd" name="cartaAd" required>
              <option value="">Selecione</option>
              <option>Assinado</option>
              <option>Não assinado</option>
            </select>
          </div>

          <div>
            <label for="cartaCons">Carta de Cons</label>
            <select id="cartaCons" name="cartaCons" required>
              <option value="">Selecione</option>
              <option>Assinado</option>
              <option>Não assinado</option>
            </select>
          </div>
        </div>

        <div>
          <label for="observacao">Observação</label>
          <textarea id="observacao" name="observacao" placeholder="Notas, bloqueios, próximos passos..."></textarea>
        </div>

        <div class="actions">
          <button type="button" class="secondary" id="clearBtn">Limpar</button>
          <button type="submit" id="saveBtn">Salvar registro</button>
        </div>

        <div id="message" aria-live="polite"></div>

      </form>

      <div class="site-footer">© <span id="footer-year"></span> Age Fibra — Sistema de Gestão by João Vieira</div>

    </main>
  </div>

  <script>
    // URL do Apps Script (coloquei a que você enviou)
    const scriptURL = "https://script.google.com/macros/s/AKfycbzGUuBpOIsP_LXiKnPhOKlQvrQS3K-56blQWr3RyW_Yd-ex7VaqDmamL6HfRGZl4tbskA/exec";

    document.getElementById('footer-year').textContent = new Date().getFullYear();

    const form = document.getElementById('managementForm');
    const msg = document.getElementById('message');
    const clearBtn = document.getElementById('clearBtn');
    const saveBtn = document.getElementById('saveBtn');

    function setMsg(html, type){
      // type: 'ok' | 'error' | 'warning'
      const cls = type === 'ok' ? 'success' : (type === 'warning' ? 'warning' : 'error');
      msg.innerHTML = `<div class="result ${cls}">${html}</div>`;
    }

    // small helper to validate required fields before sending
    function validateForm() {
      const required = ['campanha','responsavel','regiao','endereco','numero','sindico','telSindico','data','status','cartaAd','cartaCons'];
      for (const name of required) {
        const el = form.elements[name];
        if (!el) continue;
        const val = (el.value || '').toString().trim();
        if (!val) {
          el.focus();
          setMsg(`Por favor preencha o campo "${name}" antes de enviar.`, 'error');
          return false;
        }
      }
      return true;
    }

    form.addEventListener('submit', async (e) =>{
      e.preventDefault();

      // basic client validation
      if (!validateForm()) return;

      saveBtn.disabled = true;
      saveBtn.textContent = 'Enviando...';
      setMsg('Enviando dados...', 'ok');

      const fd = new FormData(form);

      try {
        const res = await fetch(scriptURL, { method: 'POST', body: fd });
        const text = await res.text();
        let json;
        try { json = JSON.parse(text); } catch (err) {
          // fallback if script returned plain text
          json = { status: res.ok ? 'ok' : 'error', message: text };
        }

        if (json.status === 'ok') {
          setMsg(`✅ Registro salvo (linha ${json.row || '—'}).`, 'ok');
          form.reset();
        } else if (json.status === 'duplicate') {
          // caso o Apps Script implemente verificação e retorne "duplicate"
          setMsg(`⚠️ Registro não inserido — idBitrix duplicado (linha ${json.existingRow || '—'}).`, 'warning');
        } else {
          setMsg(`❌ Erro ao salvar: ${json.message || 'Resposta inesperada do servidor.'}`, 'error');
          console.error('Resposta do servidor:', json);
        }

      } catch (err) {
        console.error(err);
        setMsg('❌ Erro de rede ou no servidor. Tente novamente.', 'error');
      } finally {
        saveBtn.disabled = false;
        saveBtn.textContent = 'Salvar registro';
      }
    });

    clearBtn.addEventListener('click', ()=>{
      form.reset();
      msg.innerHTML = '';
    });
  </script>
</body>
</html>



